<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Excel Renamer üìä ùÑú</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background-color: #f9f9f9; /* slightly offwhite */
      color: #333;
    }

    /* Top band */
    header {
      background-color: #819FB3; /* main top bar */
      padding: 20px;
      text-align: center;
    }
    header h1 {
      color: white;
      font-size: 28px;
      font-weight: bold;
      margin: 0;
    }

    /* Content */
    main {
      max-width: 700px;
      margin: 30px auto;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0px 2px 6px rgba(0,0,0,0.1);
    }

    .hidden { display: none; }

    #drop-zone {
      border: 2px dashed #F3E7BE;
      padding: 30px;
      text-align: center;
      margin: 20px 0;
      cursor: pointer;
      border-radius: 8px;
      background: #fdfdfd;
      transition: background 0.3s, border-color 0.3s;
      color: #6d6d6d;
      font-weight: bold;
    }
    #drop-zone:hover {
      background: #fff9e5;
      border-color: #e6d79d;
    }

    select, button, input[type=password] {
      margin: 10px 0;
      padding: 10px;
      width: 100%;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    button {
      background-color: #F3E7BE;
      color: #333;
      font-weight: bold;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background-color: #e6d79d;
    }

    #loginMessage {
      color: red;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Excel Renamer</h1>
  </header>

  <main>
    <div id="login">
      <p>Enter password to continue:</p>
      <input type="password" id="passwordInput" placeholder="Enter password">
      <button onclick="checkPassword()">Login</button>
      <p id="loginMessage"></p>
    </div>

    <div id="app" class="hidden">
      <h3>Upload and Rename Excel Files</h3>

      <label for="brand">Select Brand:</label>
      <select id="brand">
        <option>ULCH GIT</option>
        <option>ULCH Herbal</option>
        <option>ULCH Respiratory</option>
        <option>ULCH Somatics</option>
        <option>ULCH VIMS</option>
        <option>Corporate</option>
        <option>Bone Health</option>
        <option>Women's Health</option>
        <option>Pedia Milk</option>
        <option>Pedia TOTC</option>
        <option>Pedia Vita</option>
        <option>Pedia GIT</option>
        <option>Westmont Acid Neutralizer</option>
        <option>Westmont Antispasmodics</option>
        <option>Westmont Liver Protectants</option>
        <option>Westmont Somatics</option>
        <option>Westmont Antihistamine</option>
        <option>ULSSI Beauty Ingestives</option>
        <option>ULSSI Facial Moisturizer</option>
        <option>ULSSI Facial Wash</option>
        <option>ULSSI Feminine Care</option>
        <option>Hand Body Lotion</option>
        <option>Soaps</option>
        <option>Acne Control</option>
      </select>

      <label for="month">Select Month:</label>
      <select id="month">
        <option>January</option><option>February</option><option>March</option>
        <option>April</option><option>May</option><option>June</option>
        <option>July</option><option>August</option><option>September</option>
        <option>October</option><option>November</option><option>December</option>
      </select>

      <label for="year">Select Year:</label>
      <select id="year">
        <option>2025</option><option>2024</option><option>2023</option>
      </select>

      <div id="drop-zone">Drag & Drop Excel Files Here<br>or Click to Select</div>
      <input type="file" id="fileInput" multiple accept=".xls,.xlsx" style="display:none">
      <button onclick="processFiles()">Rename Files</button>
      <div id="output"></div>
    </div>
  </main>

  <!-- SheetJS library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <script>
    const PASSWORD = "UML2025";
    function checkPassword() {
      const input = document.getElementById("passwordInput").value;
      if (input === PASSWORD) {
        document.getElementById("login").classList.add("hidden");
        document.getElementById("app").classList.remove("hidden");
      } else {
        document.getElementById("loginMessage").textContent = "Incorrect password";
      }
    }

    const dropZone = document.getElementById("drop-zone");
    const fileInput = document.getElementById("fileInput");
    let selectedFiles = [];

    dropZone.addEventListener("click", () => fileInput.click());
    dropZone.addEventListener("dragover", e => { e.preventDefault(); dropZone.style.backgroundColor = "#fff9e5"; });
    dropZone.addEventListener("dragleave", e => { e.preventDefault(); dropZone.style.backgroundColor = "#fdfdfd"; });
    dropZone.addEventListener("drop", e => {
      e.preventDefault();
      dropZone.style.backgroundColor = "#fdfdfd";
      selectedFiles = [...e.dataTransfer.files];
      dropZone.textContent = selectedFiles.length + " file(s) selected";
    });
    fileInput.addEventListener("change", e => {
      selectedFiles = [...e.target.files];
      dropZone.textContent = selectedFiles.length + " file(s) selected";
    });

    function detectRules(workbook) {
      const sheetNames = workbook.SheetNames;
      if (sheetNames.length < 2) return { timeLabel: "", keyword: "" };

      const ws = workbook.Sheets[sheetNames[1]];
      const range = XLSX.utils.decode_range("A3:Z3");
      let headers = [];

      for (let C = range.s.c; C <= range.e.c; ++C) {
        let cell = ws[XLSX.utils.encode_cell({ r: 2, c: C })];
        if (cell && cell.v) headers.push(String(cell.v).toLowerCase());
      }

      let timeLabel = headers.some(h => h.includes("week")) ? "Weekly" :
                      headers.some(h => h.includes("month")) ? "Monthly" : "";

      let keyword = "";
      if (headers.includes("product") && headers.includes("copy") && headers.includes("brand")) {
        keyword = "Copy";
      } else if (headers.includes("product") && headers.includes("brand")) {
        keyword = "Brand";
      } else if (headers.includes("product")) {
        keyword = "Product";
      }

      return { timeLabel, keyword };
    }

    function processFiles() {
      if (!selectedFiles.length) { alert("Please select files first."); return; }

      const brand = document.getElementById("brand").value;
      const month = document.getElementById("month").value;
      const year = document.getElementById("year").value;

      selectedFiles.forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          const arrayBuffer = e.target.result;
          const workbook = XLSX.read(arrayBuffer, { type: "array" });
          const { timeLabel, keyword } = detectRules(workbook);

          let safeBase = `${brand} ${timeLabel} Reach Report by ${keyword} ao ${month} ${year}`;
          safeBase = safeBase.replace(/[^a-z0-9_\- ()]/gi, "_");
          const ext = file.name.split('.').pop();
          const newName = safeBase + "." + ext;

          const blob = new Blob([arrayBuffer], { type: file.type });
          const link = document.createElement("a");
          link.href = URL.createObjectURL(blob);
          link.download = newName;
          link.click();
        };
        reader.readAsArrayBuffer(file);
      });
    }
  </script>
</body>
</html>
